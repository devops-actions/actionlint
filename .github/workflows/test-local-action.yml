name: Test local action
on:
  push:
  
jobs:
  test-local-action:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Run the local action from the checked out branch
        id: action-lint
        uses: ./
        continue-on-error: true
            
      - name: Check for no reported errors
        if: steps.action-lint.outcome=='success'
        run: |
          echo "Error in 'action-lint' step, expeced a failure status, but got success"
          # fail the job so reporting can pick it up
          exit 1
      
      - name: Check for expected errors
        if: steps.action-lint.outcome=='failure'
        run: |
          echo "Todo: check the results of fake-output and fake-secret"
        
  job-with-errors:
    runs-on: ubuntu-latest
    steps:
     - name: Non existing output
       id: fake-output
       run: |
        echo "Let's echo an output that does not exist, should fail the check:"
        echo "Output that does not exist: ${{ needs.test-with-local-action.outputs.fake-output }}"
        
     - name: Non existing secret
       id: fake-secret
       run: |
        echo "Let's echo a secret that does not exist, should fail the check:"
        echo "Secret that does not exist: ${{ secrets.fake-secret }}"
